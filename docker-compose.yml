version: '3'

services:
    db:
        image: mysql
        restart: always
        environment:
          #数据库名称可能受阿里云远程镜像里面定义的devdb影响
          MYSQL_DATABASE: dj_db
          MYSQL_USER: root
          MYSQL_ROOT_PASSWORD: 123456
          MYSQL_ALLOW_EMPTY_PASSWORD: 'yes'
          MYSQL_HOST: localhost
          MYSQL_PORT: 3306  # cannot change this port to other number
        ports:
         - "3306:3306"
        command: mysqld --default-authentication-plugin=mysql_native_password --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
#        command: mysqld --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
    web:
        build: .
        command: python3 manage.py runserver 0.0.0.0:8000
        volumes:
          - .:/code
        ports:
          - "8000:8000"
        links:
          - db
        depends_on: #web容器依赖数据库容器db
          - db
